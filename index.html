<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíå</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #111; min-height: 100vh; display: flex; justify-content: center; align-items: center; background: #FFDAE9; overflow: auto; padding: 24px; }
#envelopeStage { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; position: fixed; inset: 0; z-index: 10; }
body.show-modal .container { display: flex; }
.container { display: none; flex-direction: column; text-align: center; background: white; padding: 40px 36px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: fit-content; max-width: min(650px, calc(100vw - 48px)); min-width: 0; min-height: 520px; max-height: calc(100vh - 48px); overflow-y: auto; position: relative; transform-origin: center center; transition: opacity 0.25s ease, transform 0.3s ease; }
.modal-inner { flex: 1 1 auto; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 0; width: fit-content; max-width: 100%; }
.modal-view { width: fit-content; max-width: 100%; opacity: 0; transition: opacity 0.25s ease; display: none; }
.modal-view.visible { display: block; opacity: 1; }
.envelope { position: relative; width: 220px; height: 160px; background: #f5e6d3; border: 1px solid #d4c4a8; border-radius: 4px; box-shadow: 0 4px 20px rgba(0,0,0,0.12); cursor: pointer; transition: transform 0.25s ease, box-shadow 0.25s ease; }
.envelope:hover:not(.opening) { transform: scale(1.05); box-shadow: 0 8px 28px rgba(0,0,0,0.15); }
.envelope-flap { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(165deg, #e8d5c4 0%, #d4c4a8 45%, #c9b89a 100%); clip-path: polygon(0 0, 50% 50%, 100% 0); transform-origin: top center; transition: transform 0.8s cubic-bezier(0.34,1.2,0.64,1); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.envelope-flap-outline { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
.envelope-flap-outline line { vector-effect: non-scaling-stroke; }
.envelope.opening .envelope-flap { transform: rotateX(-170deg); }
.envelope-heart { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; color: #c41e3a; pointer-events: none; z-index: 1; transition: opacity 0.35s ease; }
.envelope-heart.hidden { opacity: 0; }
.envelope-heart svg { width: 100%; height: 100%; }
.envelope-stage-fade-out { animation: envelopeFadeOut 0.5s ease forwards; }
@keyframes envelopeFadeOut { to { opacity: 0; transform: scale(0.96); } }
.puzzle-container { width: 40vh; max-width: 100%; margin: 0 auto; background: #f5f5f5; padding: 10px; border-radius: 12px; transition: background 0.4s ease; }
.puzzle-container.completed { background: #fff; }
.puzzle-grid-wrap { position: relative; width: 100%; aspect-ratio: 1; margin: 0 auto; transition: transform 0.6s cubic-bezier(0.34,1.2,0.64,1); }
.puzzle-grid-wrap.revealing { transform: scale(0.88); transition: transform 0.4s cubic-bezier(0.34,1.2,0.64,1); }
.puzzle-grid { display: grid; grid-template-columns: repeat(3,1fr); grid-template-rows: repeat(3,1fr); gap: 2px; background: transparent; padding: 0; border-radius: 8px; width: 100%; height: 100%; position: absolute; inset: 0; transition: gap 0.1s ease, padding 0.1s ease, border-radius 0.1s ease; }
.puzzle-grid.merging { gap: 0; padding: 0; border-radius: 0; }
.puzzle-tile { min-width: 0; min-height: 0; background-size: 100% 100%; background-repeat: no-repeat; background-position: center; border-radius: 8px; cursor: pointer; transition: box-shadow 0.1s ease, border-radius 0.1s ease, transform 0.1s ease; box-shadow: 0 0px 8px rgba(0,0,0,0.15); position: relative; }
.puzzle-tile:hover:not(.empty) { transform: scale(1.01); box-shadow: 0 0px 10px rgba(0,0,0,0.2); z-index: 10; }
.puzzle-grid.merging .puzzle-tile { box-shadow: none; border-radius: 0; }
.puzzle-tile.empty { box-shadow: none; cursor: default; }
.puzzle-full-image-overlay { position: absolute; inset: 0; border-radius: 8px; overflow: hidden; opacity: 0; transition: opacity 0.25s ease; pointer-events: none; }
.puzzle-full-image-overlay.show { opacity: 1; pointer-events: auto; }
.puzzle-full-image-overlay img { width: 100%; height: 100%; object-fit: cover; display: block; }
.puzzle-tile.empty:hover { transform: none; }
.puzzle-reveal-text { opacity: 0; transition: opacity 0.35s ease 0.1s; margin-top: 20px; }
.puzzle-reveal-text.show { opacity: 1; }
.puzzle-reveal-text .complete-line { font-size: 20px; color: #111; margin-bottom: 12px; line-height: 1.4; }
.puzzle-reveal-text .valentine-question { font-size: 20px; color: #111; font-weight: 600; margin-bottom: 16px; }
.shuffle-button { margin-top: 20px; padding: 10px 25px; background: linear-gradient(135deg,#f093fb 0%,#f5576c 100%); color:white; border:none; border-radius:25px; font-size:1em; cursor:pointer; font-weight:bold; transition: all 0.3s ease; }
.shuffle-button:hover { transform: scale(1.05); box-shadow:0 5px 15px rgba(245,87,108,0.4); }
.heart { font-size: 4em; margin: 20px 0; animation: heartbeat 1.5s ease-in-out infinite; }
@keyframes heartbeat { 0%,100% {transform:scale(1);} 25% {transform:scale(1.1);} }
.confetti { position: fixed; width: 10px; height: 10px; pointer-events: none; }
@keyframes confetti-fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
.sparkle { position: fixed; width: 6px; height: 6px; background: white; border-radius: 50%; pointer-events: none; animation: sparkleAnim 1s ease-out; }
@keyframes sparkleAnim { 0% {transform: scale(0) rotate(0deg); opacity:1;} 100% {transform:scale(1) rotate(180deg); opacity:0;} }
.tile-disappear { animation: tileDisappear 0.5s ease forwards; }
@keyframes tileDisappear {0%{opacity:1;transform:scale(1) rotate(0deg);}100%{opacity:0;transform:scale(0.5) rotate(180deg);}}
.yes-only-btn {font-size:20px;padding:12px 24px;background:#FFDAE9;color:#333;border:1px solid rgba(0,0,0,0.1);border-radius:50px;cursor:pointer;margin-top:8px;font-weight:600;transition:transform 0.2s ease,box-shadow 0.2s ease;}
.yes-only-btn:hover{transform:scale(1.02);box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.container.container--success {background:transparent;box-shadow:none;padding:24px;}
.success-yay {font-size:24px;font-weight:600;color:#111;margin-bottom:20px;}
.success-gif-wrap {margin:0 auto 24px;border-radius:12px;overflow:hidden;max-width:420px;}
.success-gif-wrap img {display:block;width:100%;height:auto;}
.reset-btn {background:none;border:none;color:#666;font-size:0.9em;cursor:pointer;text-decoration:underline;padding:8px 12px;margin-top:8px;font-family:inherit;}
.reset-btn:hover {color:#111;}
.quiz-container { display:flex; flex-direction:column; align-items:center; }
.quiz-question { font-size:20px; font-weight:500; margin-bottom:20px; text-align:center; transition: opacity 0.4s ease; }
.quiz-choices { display:flex; flex-direction:column; gap:12px; margin-bottom:16px; }
.choice-btn { padding:10px 18px; border-radius:50px; border:none; cursor:pointer; background:#fce4ec; font-weight:600; transition: all 0.25s ease; }
.choice-btn:hover { background:#f8bbd0; transform:scale(1.03); }
.feedback { margin-bottom:12px; font-weight:500; height:20px; opacity:0; transition: opacity 0.3s ease; }
.feedback.show { opacity:1; }
</style>
</head>
<body>
<div id="envelopeStage">
    <div class="envelope" id="envelope">
        <div class="envelope-heart" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" clip-rule="evenodd" />
            </svg>
        </div>
        <div class="envelope-flap">
            <svg class="envelope-flap-outline" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
                <line x1="0" y1="0" x2="50" y2="50" stroke="#d4c4a8" stroke-width="3"/>
                <line x1="50" y1="50" x2="100" y2="0" stroke="#d4c4a8" stroke-width="3"/>
            </svg>
        </div>
    </div>
</div>

<div class="container" id="mainContainer">
    <div class="modal-inner">

        <!-- QUIZ -->
        <div id="quizView" class="modal-view visible">
            <div class="quiz-container">
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-choices" id="quizChoices"></div>
                <div class="feedback" id="quizFeedback"></div>
            </div>
        </div>

        <!-- PUZZLE -->
        <div id="puzzleView" class="modal-view">
            <h1 class="modal-title">Dear ‰Ω≥Ëáª...</h1>
            <div class="puzzle-container" id="puzzleContainer">
                <div class="puzzle-grid-wrap" id="puzzleGridWrap">
                    <div class="puzzle-grid" id="puzzleGrid"></div>
                    <div class="puzzle-full-image-overlay" id="puzzleFullImageOverlay">
                        <img src="images/full-image.png" alt="" />
                    </div>
                </div>
            </div>
            <div class="puzzle-reveal-text" id="puzzleRevealText">
                <p class="complete-line"> Â¶≥ÊòØÊàëÁöÑÂπæÂàÜ‰πãÂπæ ‚ò∫Ô∏è </p>
                <p class="valentine-question"> Â¶≥È°òÊÑèÁï∂Êàë‰ªäÂπ¥ÁöÑ Valentine Âóé? ü•∫ </p>
                <button type="button" class="yes-only-btn" id="yesBtn"> È°òÊÑè </button>
            </div>
        </div>

        <!-- SUCCESS -->
        <div id="successView" class="modal-view">
            <p class="modal-title">Yay! ÊÑüË¨ùÁ•ûËÆìÊàëÂÄëÁõ∏ÈÅáÔºå‰πüÂæàÁèçÊÉúÂ¶≥ üôáüèª‚Äç‚ôÇÔ∏è </p>
            <div class="success-gif-wrap">
                <img src="giphy.gif" alt="" />
            </div>
            <button type="button" class="reset-btn" id="resetBtn">Reset</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const envelope = document.getElementById('envelope');
const envelopeStage = document.getElementById('envelopeStage');
const mainContainer = document.getElementById('mainContainer');
const quizView = document.getElementById('quizView');
const puzzleView = document.getElementById('puzzleView');
const puzzleGrid = document.getElementById('puzzleGrid');
const puzzleContainer = document.getElementById('puzzleContainer');
const puzzleGridWrap = document.getElementById('puzzleGridWrap');
const puzzleFullImageOverlay = document.getElementById('puzzleFullImageOverlay');
const puzzleRevealText = document.getElementById('puzzleRevealText');
const yesBtn = document.getElementById('yesBtn');
const successView = document.getElementById('successView');
const resetBtn = document.getElementById('resetBtn');
// Puzzle state
let tiles = [];
const EMPTY_PIECE = 9;
const solution = [1, 2, 3, 4, 5, 6, 7, 8, 9]; // empty = 3 at index 2
let currentState = [...solution];

const quizQuestions = [
    {
        question: "ÊàëÂÄëÁõÆÂâçÈÇÑÊ≤íÊúâÂéªÈÅéÂÖ©Ê¨°Á¥ÑÊúÉÁöÑÂú∞ÊñπÊòØ?",
        choices: ["Laguna Beach","Goguma","Balboa Island","‰ª•‰∏äÈÉΩ‰∏çÊòØ"],
        correct: 3
    },
    {
        question: "Sam ÂñúÊ≠°ÊÄéÈ∫ºÈÄó Jen?",
        choices: ["Ë™™Ë¶ÅÁµ¶Â•πÂêÉËäãÈ†≠","ÊçèÂ•πÊâãËáÇ","ËóèËµ∑‰æÜËÆìÂ•π‰æÜÊâæÊàë","Sam Âæà‰πñÔºå‰∏çÊúÉÈÄó Jen"],
        correct: 0
    },
    {
        question: "Sam ÊúÄÊ¨£Ë≥û Jen ÁöÑ‰ªÄÈ∫º?",
        choices: ["ÊúâË∂£„ÄÅÊ¥ªÊΩë","Ê∫´ÊüîËÄêÂøÉ","Â∞ç‰ªñ‰∫∫ÁöÑÊÑõ","Â∞çÂÆ∂‰∫∫ÁöÑÊÑõ"],
        correct: 3
    }
];

let currentQuestion = 0;
const quizQuestionEl = document.getElementById('quizQuestion');
const quizChoicesEl = document.getElementById('quizChoices');
const quizFeedbackEl = document.getElementById('quizFeedback');

function showQuestion() {
    const q = quizQuestions[currentQuestion];
    quizQuestionEl.textContent = q.question;
    quizChoicesEl.innerHTML = '';
    quizFeedbackEl.textContent='';
    q.choices.forEach((choice,i)=>{
        const btn = document.createElement('button');
        btn.textContent=choice;
        btn.className='choice-btn';
        btn.onclick=()=>handleAnswer(i);
        quizChoicesEl.appendChild(btn);
    });
}

function handleAnswer(i){
    const q = quizQuestions[currentQuestion];
    if(i===q.correct){
        quizFeedbackEl.textContent='Á≠îÂ∞ç‰∫Ü! ‚úÖ';
        quizFeedbackEl.classList.add('show');
        setTimeout(()=>{
            currentQuestion++;
            if(currentQuestion<quizQuestions.length){
                showQuestion();
            }else{
                quizView.classList.remove('visible');
                puzzleView.classList.add('visible');
                initPuzzle();
            }
        },800);
    }else{
        quizFeedbackEl.textContent='ÈåØË™§! ‚ùå';
        quizFeedbackEl.classList.add('show');
    }
}

// Envelope open
envelope.addEventListener('click',()=>{
    envelope.classList.add('opening');
    setTimeout(()=>{
        envelopeStage.classList.add('envelope-stage-fade-out');
        setTimeout(()=>{
            envelopeStage.style.display='none';
            mainContainer.style.display='flex';
            showQuestion();
        },500);
    },1000);
});



    
function initPuzzle() {
    scramblePuzzle();
    renderPuzzle();
}

function scramblePuzzle() {
    // Make a few random valid moves from the solved state
    // Fewer moves = easier to solve
    for (let i = 0; i < 12; i++) {
        const emptyIndex = currentState.indexOf(EMPTY_PIECE);
        const validMoves = getValidMoves(emptyIndex);
        const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
        [currentState[emptyIndex], currentState[randomMove]] = [currentState[randomMove], currentState[emptyIndex]];
    }
}

function getValidMoves(emptyIndex) {
    const validMoves = [];
    const row = Math.floor(emptyIndex / 3);
    const col = emptyIndex % 3;

    if (row > 0) validMoves.push(emptyIndex - 3); // up
    if (row < 2) validMoves.push(emptyIndex + 3); // down
    if (col > 0) validMoves.push(emptyIndex - 1); // left
    if (col < 2) validMoves.push(emptyIndex + 1); // right

    return validMoves;
}

function renderPuzzle() {
    puzzleGrid.innerHTML = '';
    tiles = [];

    currentState.forEach((piece, index) => {
        const tile = document.createElement('div');
        tile.className = 'puzzle-tile';

        if (piece === EMPTY_PIECE) {
            tile.classList.add('empty');
        } else {
            tile.style.backgroundImage = `url('images/tile-${piece}.png')`;
            tile.onclick = () => moveTile(index);
        }

        puzzleGrid.appendChild(tile);
        tiles.push(tile);
    });
}

function moveTile(index) {
    const emptyIndex = currentState.indexOf(EMPTY_PIECE);
    const validMoves = getValidMoves(emptyIndex);

    if (validMoves.includes(index)) {
        [currentState[emptyIndex], currentState[index]] = [currentState[index], currentState[emptyIndex]];
        renderPuzzle();

        if (isPuzzleSolved()) {
            setTimeout(onPuzzleSolved, 300);
        }
    }
}

function isPuzzleSolved() {
    return currentState.every((val, idx) => val === solution[idx]);
}

function onPuzzleSolved() {
    puzzleRevealText.classList.add('show');
    puzzleFullImageOverlay.classList.add('show'); // make full image visible
}

function checkComplete(tiles){
    return tiles.every((t,i)=>parseInt(t.dataset.index)===i);
}

// YES BUTTON ‚Üí SUCCESS & CONFETTI
yesBtn.addEventListener('click',()=>{
    puzzleView.classList.remove('visible');
    successView.classList.add('visible');

    const duration = 3 * 1000;
    const animationEnd = Date.now() + duration;
    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };
    const interval = setInterval(function() {
        const timeLeft = animationEnd - Date.now();
        if(timeLeft <= 0) return clearInterval(interval);
        const particleCount = 50 * (timeLeft / duration);
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random()-0.2 } }));
    },250);
});

resetBtn.addEventListener('click',()=>{
    location.reload();
});
</script>
</body>
</html>
