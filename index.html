<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíå</title>
<style>
/* --- BASIC STYLING --- */
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    color: #111;
    min-height: 100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#FFDAE9;
    overflow:auto;
    padding:24px;
}

/* --- ENVELOPE --- */
#envelopeStage {
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    position:fixed;
    inset:0;
    z-index:10;
}
.envelope {
    position: relative;
    width: 220px;
    height: 160px;
    background: #f5e6d3;
    border: 1px solid #d4c4a8;
    border-radius: 4px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
}
.envelope:hover:not(.opening) {
    transform: scale(1.05);
    box-shadow: 0 8px 28px rgba(0,0,0,0.15);
}
.envelope-flap {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background: linear-gradient(165deg, #e8d5c4 0%, #d4c4a8 45%, #c9b89a 100%);
    clip-path: polygon(0 0, 50% 50%, 100% 0);
    transform-origin: top center;
    transition: transform 0.8s cubic-bezier(0.34,1.2,0.64,1);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.envelope.opening .envelope-flap { transform: rotateX(-170deg); }
.envelope-heart {
    position:absolute;
    top:50%; left:50%;
    transform: translate(-50%,-50%);
    width:40px; height:40px;
    color:#c41e3a;
    pointer-events:none;
    z-index:1;
    transition: opacity 0.35s ease;
}
.envelope-heart.hidden { opacity:0; }

/* --- QUIZ STAGE --- */
#quizStage { display:none; flex-direction:column; align-items:center; }
.quiz-question { font-size:22px; margin-bottom:20px; text-align:center; max-width:400px; }
.quiz-options { display:flex; flex-direction:column; gap:12px; }
.quiz-options button {
    padding:10px 20px; border-radius:25px; border:none;
    background: linear-gradient(135deg,#f093fb 0%,#f5576c 100%);
    color:white; font-weight:600; font-size:18px; cursor:pointer;
    transition: all 0.3s ease;
}
.quiz-options button:hover { transform:scale(1.05); box-shadow:0 5px 15px rgba(245,87,108,0.4); }
.feedback { margin-top:12px; color:#c41e3a; font-size:16px; min-height:20px; }

/* --- PUZZLE --- */
#puzzleStage { display:none; flex-direction:column; align-items:center; }
.puzzle-container { display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr); gap:2px; width:300px; height:300px; margin-top:20px; }
.puzzle-tile { background-size:cover; border-radius:6px; cursor:pointer; transition:0.1s; }
.puzzle-tile:hover:not(.empty) { transform:scale(1.05); }
.puzzle-tile.empty { background:none; cursor:default; }

/* --- VALENTINE REVEAL --- */
#valentineReveal { display:none; flex-direction:column; align-items:center; margin-top:20px; text-align:center; }
#valentineReveal p { font-size:22px; margin-bottom:20px; }

/* --- SUCCESS SCREEN --- */
#successStage { display:none; flex-direction:column; align-items:center; text-align:center; margin-top:20px; }
#successStage p { font-size:22px; margin-bottom:20px; }
.success-gif { max-width:300px; border-radius:12px; }
.reset-btn { margin-top:12px; background:none; border:none; text-decoration:underline; font-size:16px; cursor:pointer; color:#666; }
.reset-btn:hover { color:#111; }

/* --- CONFETTI --- */
.confetti {
    position:fixed; width:10px; height:10px; pointer-events:none;
}
@keyframes confetti-fall {
    to { transform:translateY(100vh) rotate(360deg); opacity:0; }
}
</style>
</head>
<body>
<!-- ENVELOPE -->
<div id="envelopeStage">
    <div class="envelope" id="envelope">
        <div class="envelope-heart">
            ‚ù§Ô∏è
        </div>
        <div class="envelope-flap"></div>
    </div>
</div>

<!-- QUIZ -->
<div id="quizStage">
    <div class="quiz-question" id="quizQuestion"></div>
    <div class="quiz-options" id="quizOptions"></div>
    <div class="feedback" id="quizFeedback"></div>
</div>

<!-- PUZZLE -->
<div id="puzzleStage">
    <div class="puzzle-container" id="puzzleGrid"></div>
</div>

<!-- VALENTINE REVEAL -->
<div id="valentineReveal">
    <p>Â¶≥È°òÊÑèÊàêÁÇ∫‰ªäÂπ¥ÁöÑ Valentine ÂóéÔºüü•∫</p>
    <button id="yesBtn">È°òÊÑè</button>
</div>

<!-- SUCCESS -->
<div id="successStage">
    <p>Yay! ÊÑüË¨ùÁ•ûËÆìÊàëÂÄëÁõ∏ÈÅáÔºå‰πüÂæàÁèçÊÉúÂ¶≥ üôáüèª‚Äç‚ôÇÔ∏è</p>
    <img src="giphy.gif" alt="" class="success-gif" />
    <button class="reset-btn" id="resetBtn">ÈáçÊñ∞ÈñãÂßã</button>
</div>

<script>
// --- ENVELOPE CLICK ---
const envelope = document.getElementById('envelope');
envelope.addEventListener('click', ()=>{
    envelope.querySelector('.envelope-heart').classList.add('hidden');
    envelope.classList.add('opening');
    setTimeout(()=>{
        document.getElementById('envelopeStage').style.display='none';
        startQuiz();
    },800);
});

// --- QUIZ DATA ---
const quizQuestions = [
    {
        question:"ÊàëÂÄëÂà∞ÁõÆÂâçÁÇ∫Ê≠¢ÔºåÊúâÂì™‰∏ÄÂÄãÂú∞ÊñπÊàëÂÄëÈÇÑÊ≤íÊúâÂéªÈÅéÂÖ©Ê¨°Á¥ÑÊúÉÔºü",
        options:["ÊãâÂè§Á¥çÊµ∑ÁÅò","Goguma","Â∑¥ÁàæÂçö‰∫ûÂ≥∂","‰ª•‰∏äÈÉΩ‰∏çÊòØ"],
        correct:3
    },
    {
        question:"Sam ÂñúÊ≠°ÊÄéÈ∫ºÈÄó Jen Âë¢Ôºü",
        options:["Ë™™Ë¶ÅÁµ¶Â•πÂêÉËäãÈ†≠","ÊâìÂ•πÊâãËáÇ","Ë∫≤Ëµ∑‰æÜËÆìÂ•πÊâæÊàë","Sam Âæà‰πñÔºå‰∏çÊúÉÈÄó Jen"],
        correct:0
    },
    {
        question:"Sam ÊúÄÊ¨£Ë≥û Jen ÁöÑ‰ªÄÈ∫ºÂë¢Ôºü",
        options:["ÊúâË∂£„ÄÅÊ¥ªÊΩëÁöÑÂÄãÊÄß","Ê∫´ÊüîËàáËÄêÂøÉ","Â∞ç‰ªñ‰∫∫ÁöÑÊÑõ","Â∞çÂÆ∂‰∫∫ÁöÑÊÑõ"],
        correct:3
    }
];

let currentQuestion = 0;

function startQuiz(){
    document.getElementById('quizStage').style.display='flex';
    showQuestion();
}

function showQuestion(){
    const q = quizQuestions[currentQuestion];
    document.getElementById('quizQuestion').textContent = q.question;
    const optionsDiv = document.getElementById('quizOptions');
    optionsDiv.innerHTML='';
    document.getElementById('quizFeedback').textContent='';
    q.options.forEach((opt,i)=>{
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.onclick = ()=>{
            if(i===q.correct){
                currentQuestion++;
                if(currentQuestion<quizQuestions.length){
                    showQuestion();
                } else {
                    startPuzzle();
                }
            } else {
                document.getElementById('quizFeedback').textContent='Â∑Æ‰∏ÄÈªûÔºÅËÆìÊàëÂÄëÂÜçÊÉ≥ÊÉ≥ÔΩû';
            }
        };
        optionsDiv.appendChild(btn);
    });
}

// --- PUZZLE SETUP ---
const puzzleGrid = document.getElementById('puzzleGrid');
const EMPTY = 9;
let puzzleState = [1,2,3,4,5,6,7,8,EMPTY];

function startPuzzle(){
    document.getElementById('quizStage').style.display='none';
    document.getElementById('puzzleStage').style.display='flex';
    renderPuzzle();
}

function renderPuzzle(){
    puzzleGrid.innerHTML='';
    puzzleState.forEach((tile,i)=>{
        const div = document.createElement('div');
        div.className='puzzle-tile';
        if(tile!==EMPTY){ div.style.backgroundImage=`url('images/tile-${tile}.png')`; div.onclick=()=>moveTile(i);}
        else div.classList.add('empty');
        puzzleGrid.appendChild(div);
    });
}

function moveTile(index){
    const emptyIndex = puzzleState.indexOf(EMPTY);
    const row = Math.floor(index/3), col=index%3;
    const eRow = Math.floor(emptyIndex/3), eCol=emptyIndex%3;
    if((Math.abs(row-eRow)+Math.abs(col-eCol))===1){
        [puzzleState[index],puzzleState[emptyIndex]]=[puzzleState[emptyIndex],puzzleState[index]];
        renderPuzzle();
        if(puzzleState.every((v,i)=>v===i+1)) showValentine();
    }
}

function showValentine(){
    document.getElementById('puzzleStage').style.display='none';
    document.getElementById('valentineReveal').style.display='flex';
}

// --- YES BUTTON & SUCCESS ---
document.getElementById('yesBtn').addEventListener('click',()=>{
    document.getElementById('valentineReveal').style.display='none';
    document.getElementById('successStage').style.display='flex';
    runConfetti(5000);
});

document.getElementById('resetBtn').addEventListener('click',()=>window.location.reload());

// --- CONFETTI ---
function runConfetti(duration){
    const end = Date.now()+duration;
    function tick(){
        if(Date.now()<end){
            createConfetti();
            setTimeout(tick,50);
        }
    } tick();
}
function createConfetti(){
    const div = document.createElement('div');
    div.className='confetti';
    div.style.left=Math.random()*100+'%';
    div.style.top='-10px';
    div.style.background=['#f093fb','#f5576c','#ffd700','#4facfe','#FFDAE9'][Math.floor(Math.random()*5)];
    const duration = 2 + Math.random()*2;
    div.style.animation=`confetti-fall ${duration}s linear`;
    document.body.appendChild(div);
    setTimeout(()=>div.remove(),(duration+0.5)*1000);
}
</script>
</body>
</html>
