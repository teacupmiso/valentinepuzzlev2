<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’Œ</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color:#111; min-height:100vh; display:flex; justify-content:center; align-items:center; background:#FFDAE9; overflow:auto; padding:24px; }

/* Envelope stage */
#envelopeStage { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; position:fixed; inset:0; z-index:10; }
.envelope { position:relative; width:220px; height:160px; background:#f5e6d3; border:1px solid #d4c4a8; border-radius:4px; box-shadow:0 4px 20px rgba(0,0,0,0.12); cursor:pointer; transition:transform 0.25s ease, box-shadow 0.25s ease; }
.envelope:hover:not(.opening){ transform:scale(1.05); box-shadow:0 8px 28px rgba(0,0,0,0.15);}
.envelope-flap{ position:absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(165deg,#e8d5c4 0%,#d4c4a8 45%,#c9b89a 100%); clip-path: polygon(0 0, 50% 50%, 100% 0); transform-origin: top center; transition: transform 0.8s cubic-bezier(0.34,1.2,0.64,1); box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.envelope.opening .envelope-flap{ transform: rotateX(-170deg); }
.envelope-heart { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:40px; height:40px; color:#c41e3a; pointer-events:none; z-index:1; transition:opacity 0.35s ease;}
.envelope-heart.hidden{opacity:0;}
.envelope-heart svg{ width:100%; height:100%; }

body.show-modal .container { display:flex; }
.container { display:none; flex-direction:column; text-align:center; background:white; padding:40px 36px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.2); width:fit-content; max-width:min(650px, calc(100vw - 48px)); min-height:520px; overflow-y:auto; position:relative; transition:opacity 0.25s ease, transform 0.3s ease; }
.modal-inner{ display:flex; flex-direction:column; justify-content:center; align-items:center; width:100%; }
.modal-view{ display:none; opacity:0; transition:opacity 0.25s ease; width:100%; }
.modal-view.visible{ display:block; opacity:1; }

.modal-title { font-size:24px; color:#111; font-weight:500; margin-top:16px; margin-bottom:32px; }

/* Quiz questions */
.quiz-question { display:none; opacity:0; transform:translateY(20px); transition: opacity 0.4s ease, transform 0.4s ease; margin-bottom:20px; text-align:left; }
.quiz-question.show { display:block; opacity:1; transform:translateY(0); }
.quiz-question button { display:block; margin:6px 0; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; background:#f093fb; color:white; font-weight:600; transition:transform 0.2s ease; }
.quiz-question button:hover { transform:scale(1.05); }
.feedback { margin-top:8px; font-weight:600; font-size:16px; }
.feedback.correct { color:#28a745; }
.feedback.wrong { color:#dc3545; }

/* Puzzle styles */
.puzzle-container{ width:40vh; max-width:100%; margin:0 auto; background:#f5f5f5; padding:10px; border-radius:12px; transition: background 0.4s ease;}
.puzzle-container.completed{ background:#fff; }
.puzzle-grid-wrap{ position:relative; width:100%; aspect-ratio:1; margin:0 auto; }
.puzzle-grid{ display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr); gap:2px; width:100%; height:100%; position:absolute; inset:0; }
.puzzle-tile{ min-width:0; min-height:0; background-size:100% 100%; background-repeat:no-repeat; background-position:center; border-radius:8px; cursor:pointer; transition:box-shadow 0.1s ease, border-radius 0.1s ease, transform 0.1s ease; box-shadow:0 0px 8px rgba(0,0,0,0.15); position:relative; }
.puzzle-tile.empty{ box-shadow:none; cursor:default; }
.puzzle-full-image-overlay{ position:absolute; inset:0; border-radius:8px; overflow:hidden; opacity:0; pointer-events:none; transition:opacity 0.25s ease; }
.puzzle-full-image-overlay.show{ opacity:1; pointer-events:auto; }
.puzzle-full-image-overlay img{ width:100%; height:100%; object-fit:cover; display:block; }

/* Buttons */
.yes-only-btn{ font-size:20px; padding:12px 24px; background:#FFDAE9; color:#333; border:1px solid rgba(0,0,0,0.1); border-radius:50px; cursor:pointer; margin-top:8px; font-weight:600; transition:transform 0.2s ease;}
.yes-only-btn:hover{ transform:scale(1.02);}
.reset-btn{ background:none; border:none; color:#666; font-size:0.9em; cursor:pointer; text-decoration:underline; padding:8px 12px; margin-top:8px; font-family:inherit;}
.reset-btn:hover{ color:#111;}
</style>
</head>
<body>
<div id="envelopeStage">
    <div class="envelope" id="envelope">
        <div class="envelope-heart" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" clip-rule="evenodd" /></svg>
        </div>
        <div class="envelope-flap"></div>
    </div>
</div>

<div class="container">
<div class="modal-inner">
    <!-- Quiz -->
    <div id="quizView" class="modal-view visible">
        <h1 class="modal-title">è¦ªæ„›çš„ä½³è‡»...</h1>

        <div class="quiz-question">
            <p>1ï¸âƒ£ æˆ‘å€‘åˆ°ç›®å‰ç‚ºæ­¢å“ªè£¡é‚„æ²’æœ‰ç´„æœƒéå…©æ¬¡ï¼Ÿ</p>
            <button data-answer="wrong">Laguna Beach</button>
            <button data-answer="wrong">Goguma</button>
            <button data-answer="wrong">Balboa Island</button>
            <button data-answer="correct">ä»¥ä¸Šéƒ½æ²’æœ‰</button>
        </div>

        <div class="quiz-question">
            <p>2ï¸âƒ£ Samå–œæ­¡æ€éº¼é€—Jenï¼Ÿ</p>
            <button data-answer="correct">èªªè¦çµ¦å¥¹åƒèŠ‹é ­</button>
            <button data-answer="wrong">æ‰“å¥¹æ‰‹è‡‚</button>
            <button data-answer="wrong">èº²èµ·ä¾†è®“å¥¹æ‰¾</button>
            <button data-answer="wrong">Samä¸æœƒé€—Jen</button>
        </div>

        <div class="quiz-question">
            <p>3ï¸âƒ£ Samæœ€æ¬£è³Jenä»€éº¼ï¼Ÿ</p>
            <button data-answer="wrong">æœ‰è¶£æ´»æ½‘çš„å€‹æ€§</button>
            <button data-answer="wrong">æº«æŸ”è€å¿ƒ</button>
            <button data-answer="wrong">æ„›äººå¦‚å·±</button>
            <button data-answer="correct">æ„›å®¶äºº</button>
        </div>
    </div>

    <!-- Puzzle -->
    <div id="puzzleView" class="modal-view">
        <div class="puzzle-container" id="puzzleContainer">
            <div class="puzzle-grid-wrap" id="puzzleGridWrap">
                <div class="puzzle-grid" id="puzzleGrid"></div>
                <div class="puzzle-full-image-overlay" id="puzzleFullImageOverlay">
                    <img src="images/full-image.png" alt="" />
                </div>
            </div>
        </div>
        <div class="puzzle-reveal-text" id="puzzleRevealText">
            <p class="complete-line">å¦³æ˜¯æˆ‘çš„å¹¾åˆ†ä¹‹å¹¾ â˜ºï¸</p>
            <p class="valentine-question">å¦³é¡˜æ„ç•¶æˆ‘ä»Šå¹´çš„ Valentine å—? ğŸ¥º</p>
            <button type="button" class="yes-only-btn" id="yesBtn">é¡˜æ„</button>
        </div>
    </div>

    <!-- Success -->
    <div id="successView" class="modal-view">
        <p class="modal-title">Yay! æ„Ÿè¬ç¥è®“æˆ‘å€‘ç›¸é‡ï¼Œä¹Ÿå¾ˆçæƒœå¦³ ğŸ™‡ğŸ»â€â™‚ï¸ </p>
        <div class="success-gif-wrap">
            <img src="giphy.gif" alt="" />
        </div>
        <button type="button" class="reset-btn" id="resetBtn">Reset</button>
    </div>
</div>
</div>

<script>
// Envelope â†’ modal
const envelopeStage = document.getElementById('envelopeStage');
const envelope = document.getElementById('envelope');
const quizView = document.getElementById('quizView');
const puzzleView = document.getElementById('puzzleView');
const puzzleGrid = document.getElementById('puzzleGrid');
const successView = document.getElementById('successView');

envelope.addEventListener('click', () => {
    envelope.style.pointerEvents='none';
    envelope.querySelector('.envelope-heart').classList.add('hidden');
    setTimeout(()=>{
        envelope.classList.add('opening');
        setTimeout(()=>{
            envelopeStage.style.display='none';
            document.body.classList.add('show-modal');
        },700);
    },380);
});

// Quiz logic
const questions = quizView.querySelectorAll('.quiz-question');
let currentQuestionIndex = 0;
function showQuestion(index){
    questions.forEach((q,i)=>{
        q.classList.remove('show');
        const feedback = q.querySelector('.feedback');
        if(feedback) feedback.remove();
        q.querySelectorAll('button').forEach(b=>b.disabled=false);
    });
    const q = questions[index];
    q.style.display='block';
    setTimeout(()=> q.classList.add('show'),50);
}
showQuestion(currentQuestionIndex);

questions.forEach((q,index)=>{
    q.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            q.querySelectorAll('button').forEach(b=>b.disabled=true);
            let feedback = q.querySelector('.feedback');
            if(feedback) feedback.remove();
            feedback = document.createElement('div');
            feedback.classList.add('feedback');
            if(btn.dataset.answer==='correct'){
                feedback.classList.add('correct');
                feedback.textContent='ç­”å°äº†!';
                q.appendChild(feedback);
                setTimeout(()=>{
                    currentQuestionIndex++;
                    if(currentQuestionIndex<questions.length){
                        showQuestion(currentQuestionIndex);
                    } else {
                        quizView.classList.remove('visible');
                        puzzleView.classList.add('visible');
                        initPuzzle();
                    }
                },800);
            } else {
                feedback.classList.add('wrong');
                feedback.textContent='å†è©¦ä¸€æ¬¡!';
                q.appendChild(feedback);
                setTimeout(()=> q.querySelectorAll('button').forEach(b=>b.disabled=false),600);
            }
        });
    });
});

// PUZZLE CODE (unchanged, same as original)
const EMPTY_PIECE=3;
const solution=[1,2,3,4,5,6,7,8,9];
let currentState=[...solution];
let tiles=[];
function initPuzzle(){ scramblePuzzle(); renderPuzzle(); }
function scramblePuzzle(){ for(let i=0;i<12;i++){ const emptyIndex=currentState.indexOf(EMPTY_PIECE); const validMoves=getValidMoves(emptyIndex); const randomMove=validMoves[Math.floor(Math.random()*validMoves.length)]; [currentState[emptyIndex],currentState[randomMove]]=[currentState[randomMove],currentState[emptyIndex]]; } }
function getValidMoves(emptyIndex){ const validMoves=[]; const row=Math.floor(emptyIndex/3); const col=emptyIndex%3; if(row>0) validMoves.push(emptyIndex-3); if(row<2) validMoves.push(emptyIndex+3); if(col>0) validMoves.push(emptyIndex-1); if(col<2) validMoves.push(emptyIndex+1); return validMoves; }
function renderPuzzle(){ puzzleGrid.innerHTML=''; tiles=[]; currentState.forEach((piece,index)=>{ const tile=document.createElement('div'); tile.className='puzzle-tile'; if(piece===EMPTY_PIECE){ tile.classList.add('empty'); } else { tile.style.backgroundImage=`url('images/tile-${piece}.png')`; tile.onclick=()=>moveTile(index); } puzzleGrid.appendChild(tile); tiles.push(tile); }); }
function moveTile(index){ const emptyIndex=currentState.indexOf(EMPTY_PIECE); const validMoves=getValidMoves(emptyIndex); if(validMoves.includes(index)){ [currentState[emptyIndex],currentState[index]]=[currentState[index],currentState[emptyIndex]]; renderPuzzle(); if(isPuzzleSolved()) setTimeout(onPuzzleSolved,300); } }
function isPuzzleSolved(){ return currentState.every((tile,index)=>tile===solution[index]); }
function onPuzzleSolved(){ const puzzleContainer=document.getElementById('puzzleContainer'); const puzzleGridWrap=document.getElementById('puzzleGridWrap'); const puzzleRevealText=document.getElementById('puzzleRevealText'); const puzzleFullImageOverlay=document.getElementById('puzzleFullImageOverlay'); const emptyTile=puzzleGrid.querySelector('.puzzle-tile.empty'); if(emptyTile) emptyTile.style.backgroundImage="url('images/tile-3.png')"; puzzleContainer.classList.add('completed'); puzzleGrid.classList.add('merging'); setTimeout(()=>{ puzzleFullImageOverlay.classList.add('show'); setTimeout(()=>{ puzzleGridWrap.classList.add('revealing'); puzzleRevealText.classList.add('show'); },250); },280); }

// Puzzle Yes button â†’ success
document.getElementById('yesBtn').addEventListener('click', ()=>{
    const container = document.querySelector('.container');
    runConfettiFor(5000);
    container.classList.add('container--success');
    puzzleView.classList.remove('visible');
    successView.classList.add('visible');
});
document.getElementById('resetBtn').addEventListener('click', ()=>{ window.location.reload(); });

// Confetti
function runConfettiFor(ms){ const end=Date.now()+ms; function tick(){ if(Date.now()<end){ createConfetti(); setTimeout(tick,80); } } tick(); }
function createConfetti(){ const confetti=document.createElement('div'); confetti.className='confetti'; confetti.style.left=Math.random()*100+'%'; confetti.style.top='-10px'; confetti.style.background=['#f093fb','#f5576c','#ffd700','#4facfe','#FFDAE9'][Math.floor(Math.random()*5)]; const duration=2+Math.random()*2; confetti.style.animation=`confetti-fall ${duration}s linear`; document.body.appendChild(confetti); setTimeout(()=>confetti.remove(),(duration+0.5)*1000); }
</script>
</body>
</html>
